# MongoDB

* 关系型数据库和非关系型数据库
  * 数据模型：关系型有严格预定义的schema，基于表格，行列格式；非关系型数据库格式灵活，有键值对型、文档型、图型、列式；
  * 查询语言：关系型SQL；非关系型各不相同；
  * 事务：关系型支持事务ACID；非关系型不强支持事务；
  * 关系型数据库适合结构化数据，需要复杂查询的场景，需要强一致性的场景；
  * 非关系型数据库适合非结构化或半结构化数据，高并发场景；

* 分片集群，路由mongos，配置Config Server，分片实际储存数据shard（mongod）；
* 分片集群是怎么分片的，表数据会分片还是一个表一个分片
  * 集群开启分片后还要对表开启分片，没有的话会整个表在一个分片上；
  * 分片键要选择有区分度的，如ID；分片键不要选择递增或递减的，如时间戳，这种会让新增的数据持续写入第一个或最后一个分片；**分片键必须是索引字段**；
  * 分片策略：范围分片（默认）和哈希分片；
* 分片新增或删除都会触发数据迁移；

* 分片集群就是基于副本集的，因为每个分片都要有副本。MongoDB的副本同步方式是oplog，副本读取主节点的oplog，类似MySQL的binlog;

* 内存：
  * 数据缓存：频繁访问的数据会缓存在内存中（依赖操作系统的页面缓存）；
  * 索引：索引通常全部加载到内存中；
  * 聚合或排序可能需要内存保存中间结果；
  * 高并发连接：每个连接都要占用约1M内存，mongoTemplate自带连接池；

* MongoDB默认引擎是wiredTiger，存储结构是B+树；

* MongoDB分页查询：pageable是依赖skip/limit的，所以也不适合大数据量，深度翻页查询的情况；最好还是通过游标，即有索引的可排序字段

* 数据库和缓存一致性：